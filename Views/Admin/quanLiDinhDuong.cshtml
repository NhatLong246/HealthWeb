<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý dinh dưỡng - WebHealthy</title>
    <!-- CSS Files -->
    <link rel="stylesheet" href="~/asset/css/admin.css" asp-append-version="true">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- JavaScript Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <!-- JavaScript Files -->
    <script src="~/asset/js/quanLiDinhDuong.js" asp-append-version="true"></script>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar will be loaded by sidebar.js -->
        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <h1 id="page-title">Quản lý dinh dưỡng</h1>
                <div class="header-actions">
                    <button class="search-btn">
                        <i class="fas fa-search"></i>
                    </button>
                    <button class="notifications-btn">
                        <i class="fas fa-bell"></i>
                        <span class="badge">3</span>
                    </button>
                    <div class="user-menu">
                        <i class="fas fa-user-circle"></i>
                    </div>
                </div>
            </header>

            <!-- Nutrition Management Section -->
            <section id="nutrition" class="content-section active">
                <div class="section-header">
                    <h2>Quản lý dinh dưỡng / món ăn (Catalog thực phẩm)</h2>
                    <div class="header-actions-group">
                        <div class="view-toggle-group">
                            <button class="view-toggle-btn active" data-view="grid" title="Lưới">
                                <i class="fas fa-th"></i>
                            </button>
                            <button class="view-toggle-btn" data-view="list" title="Danh sách">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>
                        <button class="btn-primary" id="btn-add-food">
                            <i class="fas fa-plus"></i> Thêm món ăn
                        </button>
                    </div>
                </div>

                <!-- KPI Cards -->
                <div class="kpi-cards-grid" id="nutrition-kpi-cards">
                    <div class="kpi-card">
                        <div class="kpi-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <div class="kpi-content">
                            <h3>Tổng món ăn</h3>
                            <p class="kpi-value" id="total-foods-kpi">0</p>
                            <span class="kpi-unit">món</span>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                            <i class="fas fa-fire"></i>
                        </div>
                        <div class="kpi-content">
                            <h3>Calo TB/món</h3>
                            <p class="kpi-value" id="avg-calories-kpi">0</p>
                            <span class="kpi-unit">kcal</span>
                        </div>
                    </div>
                </div>

                <!-- Advanced Filter Bar -->
                <div class="advanced-filter-bar-enhanced">
                    <div class="filter-section filter-section--search">
                        <div class="filter-section-header">
                            <i class="fas fa-search"></i>
                            <span>TÌM KIẾM</span>
                        </div>
                        <div class="filter-input-wrapper">
                            <i class="fas fa-search filter-input-icon"></i>
                            <input type="text" class="filter-input-enhanced" id="food-search" placeholder="Tên món ăn...">
                        </div>
                    </div>

                    <div class="filter-section filter-section--unit">
                        <div class="filter-section-header">
                            <i class="fas fa-tag"></i>
                            <span>ĐƠN VỊ</span>
                        </div>
                        <div class="filter-select-wrapper">
                            <i class="fas fa-chevron-down filter-select-icon"></i>
                            <select class="filter-select-enhanced" id="filter-unit">
                                <option value="">Tất cả</option>
                                <option value="g">g (gram)</option>
                                <option value="ml">ml (milliliter)</option>
                                <option value="cái">cái</option>
                                <option value="chén">chén</option>
                                <option value="bát">bát</option>
                                <option value="ly">ly</option>
                                <option value="muỗng">muỗng</option>
                                <option value="quả">quả</option>
                            </select>
                        </div>
                    </div>

                    <div class="filter-section filter-section--calories">
                        <div class="filter-section-header">
                            <i class="fas fa-fire"></i>
                            <span>CALO (≥)</span>
                        </div>
                        <div class="filter-input-wrapper">
                            <i class="fas fa-fire filter-input-icon"></i>
                            <input type="number" class="filter-input-enhanced" id="filter-calories-min" placeholder="0" min="0">
                        </div>
                    </div>

                    <div class="filter-section filter-section--protein">
                        <div class="filter-section-header">
                            <i class="fas fa-drumstick-bite"></i>
                            <span>PROTEIN (≥)</span>
                        </div>
                        <div class="filter-input-wrapper">
                            <i class="fas fa-drumstick-bite filter-input-icon"></i>
                            <input type="number" class="filter-input-enhanced" id="filter-protein-min" placeholder="0" min="0" step="0.1">
                        </div>
                    </div>

                    <div class="filter-section filter-section--fat">
                        <div class="filter-section-header">
                            <i class="fas fa-bacon"></i>
                            <span>FAT (≥)</span>
                        </div>
                        <div class="filter-input-wrapper">
                            <i class="fas fa-bacon filter-input-icon"></i>
                            <input type="number" class="filter-input-enhanced" id="filter-fat-min" placeholder="0" min="0" step="0.1">
                        </div>
                    </div>

                    <div class="filter-section filter-section--carb">
                        <div class="filter-section-header">
                            <i class="fas fa-bread-slice"></i>
                            <span>CARB (≥)</span>
                        </div>
                        <div class="filter-input-wrapper">
                            <i class="fas fa-bread-slice filter-input-icon"></i>
                            <input type="number" class="filter-input-enhanced" id="filter-carb-min" placeholder="0" min="0" step="0.1">
                        </div>
                    </div>

                    <div class="filter-actions-enhanced">
                        <button type="button" class="btn-filter-apply" id="btn-apply-food-filter">
                            <i class="fas fa-filter"></i>
                            <span>Áp dụng lọc</span>
                        </button>
                        <button type="button" class="btn-filter-reset" onclick="resetFoodFilters()">
                            <i class="fas fa-redo-alt"></i>
                            <span>Đặt lại</span>
                        </button>
                    </div>
                </div>

                <!-- Food Cards Grid View -->
                <div class="users-cards-wrapper" id="foods-cards-view">
                    <div class="pt-cards-grid" id="food-cards-grid">
                        <!-- Food cards will be dynamically loaded here -->
                    </div>
                    <div class="empty-state" id="foods-empty-state" style="display: none;">
                        <div class="empty-icon">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <h3>Không tìm thấy món ăn nào</h3>
                        <p>Thử điều chỉnh bộ lọc của bạn hoặc thêm món ăn mới</p>
                        <button class="btn-primary" onclick="document.getElementById('btn-add-food').click()">
                            <i class="fas fa-plus"></i> Thêm món ăn mới
                        </button>
                    </div>
                </div>

                <!-- Food Table List View -->
                <div class="table-container" id="foods-table-view" style="display: none;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Tên món ăn</th>
                                <th>Đơn vị</th>
                                <th>Calo</th>
                                <th>Protein (g)</th>
                                <th>Fat (g)</th>
                                <th>Carb (g)</th>
                                <th>Hình ảnh</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="food-table-body">
                            <!-- Table rows will be dynamically loaded here -->
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="table-pagination" id="food-pagination">
                    <!-- Pagination will be dynamically generated -->
                </div>
            </section>
        </main>
    </div>

    <!-- Food Create/Edit Modal -->
    <div id="modal-food-form" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2><i class="fas fa-utensils"></i> <span id="food-form-title">Thêm món ăn mới</span></h2>
                <button class="modal-close" onclick="closeFoodModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="food-form" onsubmit="saveFood(event)">
                    <input type="hidden" id="food-id" name="foodId">

                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label for="food-name">Tên món ăn <span class="required">*</span></label>
                            <input type="text" id="food-name" name="name" class="form-input" required
                                   placeholder="VD: Ức gà nướng">
                            <small class="form-hint" id="food-name-hint"></small>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label for="food-unit-quantity">Số lượng & Đơn vị <span class="required">*</span></label>
                            <div style="display: flex; gap: 8px; align-items: flex-end;">
                                <div style="flex: 0 0 120px;">
                                    <input type="number" id="food-unit-quantity" name="unitQuantity" 
                                           class="form-input" min="0" step="0.1" 
                                           placeholder="VD: 100" style="text-align: right;">
                                    <small class="form-hint">Số lượng</small>
                                </div>
                                <div style="flex: 1;">
                                    <select id="food-unit" name="unit" class="form-input" required>
                                        <option value="">Chọn đơn vị...</option>
                                        <option value="g">g (gram)</option>
                                        <option value="ml">ml (milliliter)</option>
                                        <option value="cái">cái</option>
                                        <option value="chén">chén</option>
                                        <option value="bát">bát</option>
                                        <option value="ly">ly</option>
                                        <option value="muỗng">muỗng</option>
                                        <option value="phần">phần</option>
                                        <option value="quả">quả</option>
                                    </select>
                                    <small class="form-hint" id="food-unit-hint">Đơn vị</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label for="food-calories">Lượng calo <span class="required">*</span></label>
                            <input type="number" id="food-calories" name="calories"
                                   class="form-input" min="0" step="0.1" required
                                   placeholder="VD: 165">
                            <small class="form-hint">kcal</small>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label for="food-protein">Protein (g) <span class="required">*</span></label>
                            <input type="number" id="food-protein" name="protein"
                                   class="form-input" min="0" step="0.1" required
                                   placeholder="VD: 31">
                            <small class="form-hint">gram</small>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label for="food-fat">Chất béo (g) <span class="required">*</span></label>
                            <input type="number" id="food-fat" name="fat"
                                   class="form-input" min="0" step="0.1" required
                                   placeholder="VD: 3.6">
                            <small class="form-hint">gram</small>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label for="food-carb">Carbohydrate (g) <span class="required">*</span></label>
                            <input type="number" id="food-carb" name="carb"
                                   class="form-input" min="0" step="0.1" required
                                   placeholder="VD: 0">
                            <small class="form-hint">gram</small>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label for="food-image">Link Hình ảnh</label>
                            <input type="url" id="food-image" name="imageUrl" class="form-input"
                                   placeholder="https://example.com/image.jpg">
                            <small class="form-hint">URL hình ảnh món ăn</small>
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn-danger" id="btn-delete-food" style="display: none;" data-food-id="">
                            <i class="fas fa-trash"></i> Xóa
                        </button>
                        <button type="button" class="btn-cancel" onclick="closeFoodModal()">Hủy</button>
                        <button type="submit" class="btn-primary" id="btn-save-food">
                            <i class="fas fa-save"></i> Lưu món ăn
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Food Details Modal -->
    <div id="modal-food-detail" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content" style="max-width: 1000px; max-height: 95vh; overflow-y: auto;">
            <div class="modal-header">
                <h2><i class="fas fa-utensils"></i> Chi tiết món ăn</h2>
                <button class="modal-close" onclick="closeFoodDetailModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <div id="food-detail-content" style="padding: 0;">
                    <!-- Food details will be loaded here -->
                </div>
                <div class="modal-actions" style="padding: 24px 30px; border-top: 1px solid #f0f0f0; background: white; margin-top: 0;">
                    <button class="btn-cancel" onclick="closeFoodDetailModal()">
                        <i class="fas fa-times"></i> Đóng
                    </button>
                    <button class="btn-primary" id="btn-edit-food-from-detail">
                        <i class="fas fa-edit"></i> Chỉnh sửa
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="modal-delete-confirm" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content" style="max-width: 500px; animation: modalSlideIn 0.3s ease-out;">
            <div class="modal-header" style="border-bottom: 2px solid #fed7d7;">
                <h2 style="display: flex; align-items: center; gap: 10px; color: #c53030;">
                    <i class="fas fa-exclamation-triangle"></i> 
                    <span>Xác nhận xóa</span>
                </h2>
                <button class="modal-close" onclick="closeDeleteConfirmModal()" id="btn-close-delete-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" style="padding: 30px;">
                <div style="text-align: center; padding: 10px 0;">
                    <div style="font-size: 64px; color: #f56565; margin-bottom: 20px; animation: shake 0.5s ease-in-out;">
                        <i class="fas fa-trash-alt"></i>
                    </div>
                    <h3 style="margin-bottom: 15px; color: #2d3748; font-size: 20px; font-weight: 600;">
                        Bạn có chắc muốn xóa món ăn này?
                    </h3>
                    <p style="color: #718096; margin-bottom: 30px; line-height: 1.6; font-size: 15px;">
                        Thao tác này không thể hoàn tác. Món ăn sẽ bị xóa vĩnh viễn khỏi hệ thống.
                    </p>
                </div>
                <div class="modal-actions" style="justify-content: center; gap: 12px; margin-top: 20px;">
                    <button type="button" class="btn-cancel" onclick="closeDeleteConfirmModal()" id="btn-cancel-delete" style="min-width: 120px;">
                        <i class="fas fa-times"></i> Không
                    </button>
                    <button type="button" class="btn-danger" id="btn-confirm-delete" style="min-width: 160px;">
                        <i class="fas fa-trash"></i> Có, xóa món ăn
                    </button>
                </div>
            </div>
        </div>
    </div>

    <style>
        @@keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @@keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        #modal-delete-confirm .modal-content {
            border: 2px solid #feb2b2;
            box-shadow: 0 20px 60px rgba(245, 101, 101, 0.3);
        }

        #modal-delete-confirm .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #c53030 100%);
            box-shadow: 0 4px 15px rgba(245, 101, 101, 0.4);
        }

        #modal-delete-confirm .btn-danger:hover:not(:disabled) {
            background: linear-gradient(135deg, #e53e3e 0%, #9b2c2c 100%);
            box-shadow: 0 6px 20px rgba(245, 101, 101, 0.5);
            transform: translateY(-2px);
        }

        #modal-delete-confirm .btn-danger:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
    </style>

    <script src="~/asset/js/sidebar.js" asp-append-version="true"></script>
    <script>
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof initializeNutrition === 'function') {
                initializeNutrition();
            }
        });
    </script>
</body>
</html>

